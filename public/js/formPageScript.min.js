(function(){"use strict";let a={formNav:document.querySelector(".main-navForm"),formHeader:document.querySelector(".page-headerForm")},b=new class{constructor(a,b){this.menu=a,this.header=b}open(){if(document.querySelector(".page-header__menu-active")){let a=document.querySelector(".page-header__menu-active");a.addEventListener("click",()=>{this.header.classList.remove("page-header--menu-close"),this.menu.classList.remove("main-nav--close")})}else return}close(){if(document.querySelector(".main-nav__close-menu")){let a=document.querySelector(".main-nav__close-menu");a.addEventListener("click",()=>{this.menu.classList.add("main-nav--close"),this.header.classList.add("page-header--menu-close")})}else return}}(a.formNav,a.formHeader);b.open(),b.close();let c={"user-info":{"user-name":localStorage.getItem("user-name")||"","user-surname":localStorage.getItem("user-surname")||"","user-patronym":localStorage.getItem("user-patronym")||""},"contact-info":{"user-tel":localStorage.getItem("user-tel")||"","user-email":localStorage.getItem("user-email")||""},"impression-info":{title:"\u0421\u043A\u043E\u0440\u0435\u0435 \u043F\u043E\u043B\u043E\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435"},"attractions-info":{bridge:!1,mountain:!1,park:!1,rocks:!1},"emotion-info":{text:localStorage.getItem("emotion-info")||null}};class SaveUserData{constructor(a){this.field=a}setUserData(a){this.field.addEventListener("blur",b=>{let d=b.target;if(arguments[0]&&!a.test(d.value))return void d.classList.add("error-field");let e,f=d;for(;"FORM"!==d.tagName;)if("FIELDSET"===d.tagName){e=d;break}else d=d.parentNode;c[e.getAttribute("data")][f.getAttribute("data")]=f.value,localStorage.setItem(f.getAttribute("data"),f.value)})}}class SaveUserInfoRequired extends SaveUserData{checkData(){this.field.addEventListener("input",()=>{this.addClass(this.field),this.removeClass(this.field)})}setClass(){this.field.addEventListener("focus",()=>{this.field.classList.add("required-field"),this.checkData(),this.field.classList.remove("empty-field")})}addClass(a){""===a.value&&a.classList.add("required-field")}removeClass(a){""!==a.value&&a.classList.remove("required-field")}}let d={name:document.querySelector("#user-name"),surname:document.querySelector("#user-surname"),patronym:document.querySelector("#user-patronym")},e=new SaveUserInfoRequired(d.name);e.setUserData(/^[а-яА-ЯёЁa-zA-Z0-9]+$/),e.setClass();let f=new SaveUserInfoRequired(d.surname);f.setUserData(/^[а-яА-ЯёЁa-zA-Z0-9]+$/),f.setClass();let g=new SaveUserData(d.patronym);g.setUserData(/^[а-яА-ЯёЁa-zA-Z]+$/);let h={tel:document.querySelector("#user-tel"),email:document.querySelector("#user-mail"),expTel:/[0-9]{6,10}/,expEmail:/^[-\w]+@([A-z0-9][-A-z0-9]+\.)+[A-z]$/},i=new SaveUserInfoRequired(h.tel);i.setUserData(h.expTel),i.setClass();let j=new SaveUserInfoRequired(h.email);j.setUserData(),j.setClass();let k=document.querySelector(".impression-info"),l=new class{constructor(a){this.container=a}getElem(){this.container.addEventListener("click",a=>{let b=a.target;if(b.closest(".impression-info__elem")){let a=b.closest(".impression-info__elem");c[this.container.getAttribute("data")].title=a.querySelector(".impression-info__note").textContent}})}}(k);l.getElem();let m=13,n=document.querySelector(".impression-info__wrapper");let o=new class{constructor(a=n){this.container=a}getParentElem(){return Array.from(this.container.querySelectorAll(".impression-info__elem"))}getActiveElem(){let a,b=this.getParentElem();return b.forEach(b=>{let c=Array.from(b.children);c.map(b=>{b.classList.contains("impression-info__select--active")&&(a=b)})}),a}clickOnDiv(a){let b=this.getActiveElem(),c=a.target;c.classList.contains("impression-info__select")&&(b.classList.remove("impression-info__select--active"),c.classList.add("impression-info__select--active"))}addClassBySelect(){this.container.addEventListener("click",a=>{this.clickOnDiv(a)}),this.container.addEventListener("keydown",a=>{a.keyCode==m&&this.clickOnDiv(a)})}clickOnLabel(a){let b=this.getActiveElem(),c=a.target;if(c.classList.contains("impression-info__note")){b.classList.remove("impression-info__select--active");let a=c.parentNode;a=a.querySelector(".impression-info__select"),a.classList.add("impression-info__select--active")}else return}addClassByLabel(){this.container.addEventListener("click",a=>{this.clickOnLabel(a)}),this.container.addEventListener("keydown",a=>{a.keyCode===m&&this.clickOnLabel(a)})}};o.addClassBySelect(),o.addClassByLabel();let p=document.querySelector(".attractions-info");let q=new class{constructor(a=p){this.container=p}evtHandler(a){let b=a.target;b.classList.contains("attractions-info__select")&&b.classList.toggle("attractions-info__select--active")}addChoiceOnClick(){try{this.container.addEventListener("click",a=>{this.evtHandler(a)})}catch(a){console.log(a)}}addChoiceOnEnter(){this.container.addEventListener("keydown",a=>{a.keyCode==13&&this.evtHandler(a)})}addChoiceOnLabel(){this.container.addEventListener("click",a=>{let b=a.target;b.classList.contains("attractions-info__note")&&b.parentNode.querySelector(".attractions-info__select").classList.toggle("attractions-info__select--active")})}};q.addChoiceOnClick(),q.addChoiceOnEnter(),q.addChoiceOnLabel();let r=document.querySelector(".attractions-info"),s=new class{constructor(a){this.container=a}getElem(){this.container.addEventListener("click",a=>{let b=a.target;if(!b.closest(".attractions-info__elem"))return;let d=b.closest(".attractions-info__elem"),e=d.querySelector(".attractions-info__note");c[this.container.getAttribute("data")][e.getAttribute("data")]=!0,console.log(c["attractions-info"])})}}(r);s.getElem();let t=document.querySelector(".emotion-info");console.log(t);let u=new class{constructor(a){this.container=a}saveReview(a){let b=this.container.querySelector(a);b.addEventListener("blur",()=>{c[this.container.getAttribute("data")].text=b.value,localStorage.setItem(this.container.getAttribute("data"),b.value)})}}(t);u.saveReview(".emotion-info__personal");let v=document.querySelector(".review__form");const w={userName:v.querySelector("#user-name"),userSurname:v.querySelector("#user-surname"),userPatronym:v.querySelector("#user-patronym"),userTel:v.querySelector("#user-tel"),userMail:v.querySelector("#user-mail"),userEmotion:v.querySelector(".emotion-info__personal")};let x=document.querySelector("#form-result-template").content,y=document.createDocumentFragment(),z=x.querySelector(".form-notSend"),A=x.querySelector(".form-send"),B=document.querySelector(".review");let C=document.querySelector(".review__btn-send"),D=new class{constructor(a){this.btn=a}checkRequiredFields(a){for(let b in a)""!==a[b].value&&a[b].classList.remove("required-field")}showPopup(a,b){y=a.cloneNode(!0),B.appendChild(y);let c=B.querySelector(b);c.addEventListener("click",()=>{B.removeChild(y)})}init(){this.btn.addEventListener("click",a=>{if(a.preventDefault(),this.checkRequiredFields(w),document.body.querySelector(".required-field")){let a=document.body.querySelectorAll(".required-field");for(let b=0;b<a.length;b++)a[b].classList.add("empty-field");this.showPopup(z,".main-btn-notSend")}else if(document.body.querySelector(".error-field"))this.showPopup(z,".main-btn-notSend");else{let a=new XMLHttpRequest;a.open("POST","/save-data"),a.setRequestHeader("Content-type","application/json; charset=utf-8");let b=JSON.stringify(c);a.onload=()=>{console.log(a.responseText)},a.send(b),this.showPopup(A,".main-btn--send")}})}}(C);D.init(),window.addEventListener("load",()=>{for(let a in w)localStorage.getItem(w[a].getAttribute("data"))&&(w[a].value=localStorage.getItem(w[a].getAttribute("data")))})})();